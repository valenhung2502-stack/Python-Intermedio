import sqlite3

class ViajesDB:
    def __init__(self, db_path="pasajes.db"):
        self.db_path = db_path
        self._crear_tabla()

    def _conectar(self):
        """devolviendo una conexi√≥n nueva en la base"""
        return sqlite3.connect(self.db_path)

    def _crear_tabla(self):
        """crear la tabla si no existe"""
        sql="""
        CREATE TABLE IF NOT EXISTS viajes(
                dni TEXT PRIMARY KEY,
                nombre TEXT NOT NULL,
                apellido TEXT NOT NULL,
                pasaje TEXT,
                horario TEXT,
                destino TEXT,
                fecha TEXT
        )
        """
        with self._conectar() as con:
            con.execute(sql)

    def agregar(self,dni, nombre, apellido, pasaje, horario, destino, fecha):
        sql = """
        INSERT INTO viajes(dni, nombre, apellido, pasaje, horario, destino, fecha)
        VALUES(?,?,?,?,?,?,?)
        """
        with self._conectar() as con:
                con.execute(sql,(dni,nombre,apellido,pasaje,horario,destino,fecha))

    def borrar(self, dni):
        """Borrando un regsitro por DNI"""
        with self.conectar() as con:
            con.execute("DELETE FROM viajes WHERE dni=?",(dni,))

    def modificar(self,dni_original, nombre, apellido, pasaje, horario, destino, fecha):
            sql = """
            UPDATE viajes
            SET nombre=?, apellido=?, pasaje=?, horario=?, destino=?, fecha=?
            WHERE dni=?
            """
            with self._conectar() as con:
                con.execute(sql,(nombre, apellido, pasaje, horario, destino, fecha, dni_original))

    def obtener_registros(self):
        with self._conectar() as con:
            cursor = con.cursor()
            cursor.execute("SELECT * FROM viajes ORDER BY dni ASC")
            return cursor.fetchall()
